<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GarantX for RF Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        @keyframes neonPulse {
            0% { box-shadow: 0 0 5px #FF007A, 0 0 10px #00D4FF, 0 0 15px #8B00FF; }
            50% { box-shadow: 0 0 15px #FF007A, 0 0 30px #00D4FF, 0 0 45px #8B00FF; }
            100% { box-shadow: 0 0 5px #FF007A, 0 0 10px #00D4FF, 0 0 15px #8B00FF; }
        }
        .neon-button {
            animation: neonPulse 1.5s infinite;
            transition: transform 0.2s;
        }
        .neon-button:hover {
            transform: scale(1.05);
        }
        .no-copy {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
        }
        .gradient-bg {
            background: #1A1A1A;
        }
        #webgl-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .hologram {
            opacity: 0;
            transform: translateY(20px);
            animation: hologramFade 0.5s forwards;
        }
        @keyframes hologramFade {
            to { opacity: 1; transform: translateY(0); }
        }
        .modal {
            z-index: 1000;
            display: none;
        }
        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="gradient-bg text-white font-montserrat">
    <div id="webgl-bg"></div>
    <div class="container max-w-md mx-auto p-4 relative z-10">
        <h1 class="text-5xl font-orbitron text-center bg-gradient-to-r from-pink-500 to-cyan-500 bg-clip-text text-transparent mb-2 animate-pulse">GarantX</h1>
        <h2 class="text-xl font-montserrat text-center text-purple-500 mb-6 hologram">for RF Online</h2>
        <div class="grid grid-cols-2 gap-4">
            <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-3 rounded-lg hologram" onclick="showModal('create-deal')">–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</button>
            <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-3 rounded-lg hologram" onclick="showModal('deals')">–ú–æ–∏ —Å–¥–µ–ª–∫–∏</button>
            <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-3 rounded-lg hologram" onclick="showModal('support')">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
            <button class="neon-button bg-black border-2 border-green-500 text-green-500 p-3 rounded-lg hologram" onclick="showModal('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
        <div class="mt-6">
            <h2 class="text-2xl font-semibold mb-2 hologram">–ê–∫—Ü–∏–∏</h2>
            <div class="bg-gray-800 p-4 rounded-lg animate-pulse hologram">üî• 1% –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç—ã RF Online!</div>
        </div>
        <div class="mt-6">
            <h2 class="text-2xl font-semibold mb-2 hologram">–ù–æ–≤–æ—Å—Ç–∏</h2>
            <div id="news" class="bg-gray-800 p-4 rounded-lg"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏ -->
    <div id="create-deal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-pink-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</h2>
            <input id="deal-item" type="text" placeholder="–¢–æ–≤–∞—Ä (–Ω–∞–ø—Ä., Bellato Sword +7)" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <input id="deal-price" type="number" placeholder="–¶–µ–Ω–∞" step="0.01" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <select id="deal-currency" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
                <option value="‚ÇΩ">RUB</option>
                <option value="USD">USD</option>
            </select>
            <input id="deal-partner" type="text" placeholder="–ü–∞—Ä—Ç–Ω–µ—Ä (@username)" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="createDeal()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded" onclick="closeModal('create-deal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–æ–∏ —Å–¥–µ–ª–∫–∏ -->
    <div id="deals" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-pink-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ú–æ–∏ —Å–¥–µ–ª–∫–∏</h2>
            <div id="deal-list" class="space-y-4"></div>
            <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded mt-4" onclick="closeModal('deals')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profile" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-cyan-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div class="flex items-center mb-4">
                <div id="avatar" class="w-16 h-16 rounded-full border-2 border-pink-500 mr-4"></div>
                <div>
                    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="user-name"></span></p>
                    <p>–†–µ–π—Ç–∏–Ω–≥: <span id="user-rating"></span></p>
                    <p>–ë–∞–ª–∞–Ω—Å: <span id="user-balance">0 ‚ÇΩ</span></p>
                </div>
            </div>
            <button class="neon-button bg-black border-2 border-yellow-500 text-yellow-500 p-2 rounded mb-4" onclick="showModal('withdraw')">–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
            <canvas id="deal-chart" class="mb-4"></canvas>
            <p>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</p>
            <div id="achievements" class="grid grid-cols-3 gap-2 mb-4"></div>
            <p>–û—Ç–∑—ã–≤—ã:</p>
            <div id="reviews" class="space-y-2 mb-4">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</div>
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="closeModal('profile')">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="neon-button bg-black border-2 border-purple-500 text-purple-500 p-2 rounded" onclick="showModal('admin-panel')" id="admin-button" style="display: none;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ -->
    <div id="withdraw" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-yellow-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞</h2>
            <input id="withdraw-amount" type="number" placeholder="–°—É–º–º–∞ (‚ÇΩ)" step="0.01" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <input id="withdraw-card" type="text" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="requestWithdraw()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å</button>
                <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded" onclick="closeModal('withdraw')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
    <div id="admin-panel" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-purple-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <h3 class="text-lg mb-2">–°–¥–µ–ª–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</h3>
            <div id="admin-deals" class="space-y-4"></div>
            <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded mt-4" onclick="closeModal('admin-panel')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
    <div id="support" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-green-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
            <textarea id="support-message" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..." class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white"></textarea>
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="sendSupportMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded" onclick="closeModal('support')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram
        if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
            document.body.innerHTML = '<h1 class="text-center text-2xl mt-10">–û—à–∏–±–∫–∞: –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram</h1>';
            throw new Error('Telegram authorization failed');
        }

        // –ú–æ–∫-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
        const mockProfile = {
            username: tg.initDataUnsafe.user.username || "–ê–Ω–æ–Ω–∏–º",
            rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ",
            achievements: ["–ù–æ–≤–∏—á–æ–∫", "RF-—Ç–æ—Ä–≥–æ–≤–µ—Ü"],
            isAdmin: tg.initDataUnsafe.user.id === 123 // –ú–æ–∫: ID 123 ‚Äî –∞–¥–º–∏–Ω
        };

        // –ú–æ–∫-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π
        const mockNews = [
            { text: "@CyberTrader –ø—Ä–æ–¥–∞–ª –∞–∫–∫–∞—É–Ω—Ç RF Online –∑–∞ 5000‚ÇΩ!" },
            { text: "–ù–æ–≤–∞—è –∞–∫—Ü–∏—è: 1% –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ –∏–≥—Ä–æ–≤—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏!" }
        ];

        // WebGL —Ñ–æ–Ω
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('webgl-bg'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        const geometry = new THREE.BufferGeometry();
        const vertices = new Float32Array(2000).map(() => Math.random() * 100 - 50);
        geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
        const material = new THREE.PointsMaterial({ color: 0x00D4FF, size: 0.3 });
        const points = new THREE.Points(geometry, material);
        scene.add(points);
        camera.position.z = 50;
        function animate() {
            requestAnimationFrame(animate);
            points.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
        animate();

        // Haptic Feedback
        function vibrate() {
            if (navigator.vibrate) navigator.vibrate(50);
        }
        document.querySelectorAll('.neon-button').forEach(btn => btn.addEventListener('click', vibrate));

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        function showModal(id) {
            document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('active'));
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('active');
                gsap.from(`#${id} .hologram`, { opacity: 0, y: 20, stagger: 0.1 });
                if (id === 'deals') loadDeals();
                if (id === 'profile') loadProfile();
                if (id === 'admin-panel') loadAdminPanel();
            }
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                gsap.to(`#${id} .hologram`, {
                    opacity: 0,
                    y: 20,
                    stagger: 0.1,
                    onComplete: () => modal.classList.remove('active')
                });
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏
        function createDeal() {
            const item = document.getElementById('deal-item').value;
            const price = document.getElementById('deal-price').value;
            const currency = document.getElementById('deal-currency').value;
            const partner = document.getElementById('deal-partner').value;

            if (!item || !price || !currency || !partner) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            if (!partner.startsWith('@')) {
                tg.showAlert('–ü–∞—Ä—Ç–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @ (–Ω–∞–ø—Ä., @username)');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –≤ localStorage
            const deal = {
                id: Date.now(),
                item,
                price: parseFloat(price),
                currency,
                sellerId: tg.initDataUnsafe.user.id,
                buyerId: partner, // –ú–æ–∫: –ø–∞—Ä—Ç–Ω–µ—Ä –∫–∞–∫ ID
                status: 'created',
                createdAt: new Date().toISOString(),
                paymentProof: null
            };
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            deals.push(deal);
            localStorage.setItem('deals', JSON.stringify(deals));

            tg.showAlert(`–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!\n–¢–æ–≤–∞—Ä: ${item}\n–¶–µ–Ω–∞: ${price} ${currency}\n–ü–∞—Ä—Ç–Ω–µ—Ä: ${partner}`);
            closeModal('create-deal');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫
        function loadDeals() {
            const dealList = document.getElementById('deal-list');
            const deals = JSON.parse(localStorage.getItem('deals') || '[]').filter(
                deal => deal.sellerId === tg.initDataUnsafe.user.id || deal.buyerId === `@${tg.initDataUnsafe.user.username}`
            );
            dealList.innerHTML = deals.length ? deals.map((deal, index) => {
                const isSeller = deal.sellerId === tg.initDataUnsafe.user.id;
                const isBuyer = deal.buyerId === `@${tg.initDataUnsafe.user.username}`;
                let actions = '';
                if (isBuyer && deal.status === 'created') {
                    actions = `
                        <input id="proof-${deal.id}" type="text" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —á–µ–∫" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-2 text-white">
                        <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="submitPaymentProof(${index}, '${deal.id}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫</button>
                    `;
                } else if (isSeller && deal.status === 'payment_verified') {
                    actions = `<button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="transferGoods(${index})">–ü–µ—Ä–µ–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</button>`;
                } else if (isBuyer && deal.status === 'goods_transferred') {
                    actions = `<button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="confirmGoods(${index})">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ</button>`;
                } else if (isSeller && deal.status === 'buyer_confirmed') {
                    actions = `<button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="confirmDeal(${index})">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–¥–µ–ª–∫—É</button>`;
                }
                if (deal.status !== 'completed' && deal.status !== 'canceled') {
                    actions += `<button class="neon-button bg-black border-2 border-red-500 text-red-500 p-2 rounded mt-2" onclick="cancelDeal(${index})">–û—Ç–º–µ–Ω–∏—Ç—å</button>`;
                }
                return `
                    <div class="bg-gray-800 p-4 rounded-lg hologram">
                        <p><strong>–¢–æ–≤–∞—Ä:</strong> ${deal.item}</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> ${deal.price} ${deal.currency}</p>
                        <p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> ${deal.sellerId}</p>
                        <p><strong>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:</strong> ${deal.buyerId}</p>
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${getStatusText(deal.status)}</p>
                        ${deal.paymentProof ? `<p><strong>–ß–µ–∫:</strong> ${deal.paymentProof}</p>` : ''}
                        <p><strong>–î–∞—Ç–∞:</strong> ${new Date(deal.createdAt).toLocaleString()}</p>
                        ${actions}
                    </div>
                `;
            }).join('') : '<p class="hologram text-center">–°–¥–µ–ª–æ–∫ –Ω–µ—Ç</p>';
        }

        // –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function getStatusText(status) {
            const statusMap = {
                created: '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã',
                payment_pending: '–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã',
                payment_verified: '–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞',
                goods_transferred: '–¢–æ–≤–∞—Ä –ø–µ—Ä–µ–¥–∞–Ω',
                buyer_confirmed: '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª',
                completed: '–ó–∞–≤–µ—Ä—à–µ–Ω–∞',
                canceled: '–û—Ç–º–µ–Ω–µ–Ω–∞'
            };
            return statusMap[status] || status;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º
        function submitPaymentProof(index, dealId) {
            const proof = document.getElementById(`proof-${dealId}`).value;
            if (!proof) {
                tg.showAlert('–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —á–µ–∫!');
                return;
            }
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            if (deals[index].buyerId === `@${tg.initDataUnsafe.user.username}` && deals[index].status === 'created') {
                deals[index].status = 'payment_pending';
                deals[index].paymentProof = proof;
                localStorage.setItem('deals', JSON.stringify(deals));
                tg.showAlert('–ß–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!');
                loadDeals();
            }
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–æ–º
        function verifyPayment(index) {
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            if (deals[index].status === 'payment_pending') {
                deals[index].status = 'payment_verified';
                localStorage.setItem('deals', JSON.stringify(deals));
                tg.showAlert('–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!');
                loadAdminPanel();
            }
        }

        // –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–æ–º
        function transferGoods(index) {
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            if (deals[index].sellerId === tg.initDataUnsafe.user.id && deals[index].status === 'payment_verified') {
                deals[index].status = 'goods_transferred';
                localStorage.setItem('deals', JSON.stringify(deals));
                tg.showAlert('–¢–æ–≤–∞—Ä –ø–µ—Ä–µ–¥–∞–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—é!');
                loadDeals();
            }
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º
        function confirmGoods(index) {
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            if (deals[index].buyerId === `@${tg.initDataUnsafe.user.username}` && deals[index].status === 'goods_transferred') {
                deals[index].status = 'buyer_confirmed';
                localStorage.setItem('deals', JSON.stringify(deals));
                tg.showAlert('–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!');
                loadDeals();
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–º
        function confirmDeal(index) {
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            if (deals[index].sellerId === tg.initDataUnsafe.user.id && deals[index].status === 'buyer_confirmed') {
                deals[index].status = 'completed';
                // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø—Ä–æ–¥–∞–≤—Ü–∞
                const balances = JSON.parse(localStorage.getItem('balances') || '{}');
                balances[deals[index].sellerId] = (balances[deals[index].sellerId] || 0) + deals[index].price;
                localStorage.setItem('balances', JSON.stringify(balances));
                localStorage.setItem('deals', JSON.stringify(deals));
                tg.showAlert(`–°–¥–µ–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! ${deals[index].price} ${deals[index].currency} –∑–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å.`);
                loadDeals();
            }
        }

        // –û—Ç–º–µ–Ω–∞ —Å–¥–µ–ª–∫–∏
        function cancelDeal(index) {
            const deals = JSON.parse(localStorage.getItem('deals') || '[]');
            if (deals[index].sellerId === tg.initDataUnsafe.user.id || deals[index].buyerId === `@${tg.initDataUnsafe.user.username}`) {
                deals[index].status = 'canceled';
                localStorage.setItem('deals', JSON.stringify(deals));
                tg.showAlert('–°–¥–µ–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞!');
                loadDeals();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function loadAdminPanel() {
            const adminDeals = document.getElementById('admin-deals');
            const deals = JSON.parse(localStorage.getItem('deals') || '[]').filter(deal => deal.status === 'payment_pending');
            adminDeals.innerHTML = deals.length ? deals.map((deal, index) => `
                <div class="bg-gray-800 p-4 rounded-lg hologram">
                    <p><strong>–¢–æ–≤–∞—Ä:</strong> ${deal.item}</p>
                    <p><strong>–¶–µ–Ω–∞:</strong> ${deal.price} ${deal.currency}</p>
                    <p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> ${deal.sellerId}</p>
                    <p><strong>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:</strong> ${deal.buyerId}</p>
                    <p><strong>–ß–µ–∫:</strong> ${deal.paymentProof}</p>
                    <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="verifyPayment(${index})">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
                </div>
            `).join('') : '<p class="hologram text-center">–ù–µ—Ç —Å–¥–µ–ª–æ–∫ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</p>';
        }

        // –ó–∞–ø—Ä–æ—Å –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤
        function requestWithdraw() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const card = document.getElementById('withdraw-card').value;
            if (!amount || !card) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            const balances = JSON.parse(localStorage.getItem('balances') || '{}');
            const userBalance = balances[tg.initDataUnsafe.user.id] || 0;
            if (amount > userBalance) {
                tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!');
                return;
            }
            balances[tg.initDataUnsafe.user.id] -= amount;
            localStorage.setItem('balances', JSON.stringify(balances));
            tg.showAlert(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ ${amount} ‚ÇΩ –Ω–∞ –∫–∞—Ä—Ç—É ${card} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`);
            closeModal('withdraw');
            loadProfile();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
        function loadProfile() {
            document.getElementById('user-name').innerText = mockProfile.username;
            document.getElementById('user-rating').innerText = mockProfile.rating;
            document.getElementById('avatar').style.backgroundImage = `url(${tg.initDataUnsafe.user.photo_url || 'https://via.placeholder.com/64'})`;
            const balances = JSON.parse(localStorage.getItem('balances') || '{}');
            document.getElementById('user-balance').innerText = `${balances[tg.initDataUnsafe.user.id] || 0} ‚ÇΩ`;
            document.getElementById('achievements').innerHTML = mockProfile.achievements.map(a => `
                <div class="bg-gray-800 p-2 rounded hologram">${a}</div>
            `).join('');
            new Chart(document.getElementById('deal-chart'), {
                type: 'line',
                data: {
                    labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä'],
                    datasets: [{ label: '–°–¥–µ–ª–∫–∏', data: [10, 20, 15, 25], borderColor: '#00D4FF' }]
                },
                options: { plugins: { legend: { labels: { color: '#fff' } } }, scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } } }
            });
            document.getElementById('admin-button').style.display = mockProfile.isAdmin ? 'block' : 'none';
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        function sendSupportMessage() {
            const message = document.getElementById('support-message').value;
            if (!message) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!');
                return;
            }
            tg.showAlert('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            closeModal('support');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
        function loadNews() {
            document.getElementById('news').innerHTML = mockNews.map(n => `<p class="hologram">${n.text}</p>`).join('');
        }
        loadNews();
    </script>
</body>
</html>
