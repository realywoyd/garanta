<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GarantX for RF Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        @keyframes neonPulse {
            0% { box-shadow: 0 0 5px #FF007A, 0 0 10px #00D4FF, 0 0 15px #8B00FF; }
            50% { box-shadow: 0 0 15px #FF007A, 0 0 30px #00D4FF, 0 0 45px #8B00FF; }
            100% { box-shadow: 0 0 5px #FF007A, 0 0 10px #00D4FF, 0 0 15px #8B00FF; }
        }
        .neon-button {
            animation: neonPulse 1.5s infinite;
            transition: transform 0.2s;
        }
        .neon-button:hover {
            transform: scale(1.05);
        }
        .no-copy {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
        }
        .gradient-bg {
            background: #1A1A1A;
        }
        #webgl-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .hologram {
            opacity: 0;
            transform: translateY(20px);
            animation: hologramFade 0.5s forwards;
        }
        @keyframes hologramFade {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg text-white font-montserrat">
    <div id="webgl-bg"></div>
    <div class="container max-w-md mx-auto p-4 relative z-10">
        <h1 class="text-5xl font-orbitron text-center bg-gradient-to-r from-pink-500 to-cyan-500 bg-clip-text text-transparent mb-2 animate-pulse">GarantX</h1>
        <h2 class="text-xl font-montserrat text-center text-purple-500 mb-6 hologram">for RF Online</h2>
        <div class="grid grid-cols-2 gap-4">
            <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-3 rounded-lg hologram" onclick="showModal('create-deal')">–°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É</button>
            <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-3 rounded-lg hologram" onclick="showModal('deals')">–ú–æ–∏ —Å–¥–µ–ª–∫–∏</button>
            <button class="neon-button bg-black border-2 border-purple-500 text-purple-500 p-3 rounded-lg hologram" onclick="showModal('catalog')">–ö–∞—Ç–∞–ª–æ–≥</button>
            <button class="neon-button bg-black border-2 border-yellow-500 text-yellow-500 p-3 rounded-lg hologram" onclick="showModal('auctions')">–ê—É–∫—Ü–∏–æ–Ω—ã</button>
            <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-3 rounded-lg hologram" onclick="showModal('support')">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
            <button class="neon-button bg-black border-2 border-green-500 text-green-500 p-3 rounded-lg hologram" onclick="showModal('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
        <div class="mt-6">
            <h2 class="text-2xl font-semibold mb-2 hologram">–ê–∫—Ü–∏–∏</h2>
            <div class="bg-gray-800 p-4 rounded-lg animate-pulse hologram">üî• 1% –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç—ã RF Online!</div>
        </div>
        <div class="mt-6">
            <h2 class="text-2xl font-semibold mb-2 hologram">–¢–æ–ø —Ç–æ–≤–∞—Ä—ã</h2>
            <div id="top-items" class="grid grid-cols-1 gap-4"></div>
        </div>
        <div class="mt-6">
            <h2 class="text-2xl font-semibold mb-2 hologram">–ù–æ–≤–æ—Å—Ç–∏</h2>
            <div id="news" class="bg-gray-800 p-4 rounded-lg"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏ -->
    <div id="create-deal" class="fixed inset-0 bg-black bg-opacity-80 hidden flex items-center justify-center z-50">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-pink-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞</h2>
            <input id="deal-item" type="text" placeholder="–¢–æ–≤–∞—Ä (–Ω–∞–ø—Ä., –ê–∫–∫–∞—É–Ω—Ç Accretia)" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white" list="rf-items">
            <datalist id="rf-items">
                <option value="–ê–∫–∫–∞—É–Ω—Ç Accretia">
                <option value="–ê–∫–∫–∞—É–Ω—Ç Bellato">
                <option value="–ê–∫–∫–∞—É–Ω—Ç Cora">
                <option value="–û—Ä—É–∂–∏–µ +7">
                <option value="–ë—Ä–æ–Ω—è +6">
                <option value="100000 CP">
            </datalist>
            <input id="deal-price" type="number" placeholder="–¶–µ–Ω–∞" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <select id="deal-currency" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
                <option value="‚ÇΩ">RUB</option>
                <option value="USD">USD</option>
            </select>
            <input id="deal-partner" type="text" placeholder="Telegram ID (@username)" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <input id="deal-time" type="number" placeholder="–°—Ä–æ–∫ (—á–∞—Å—ã)" class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white">
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="createDeal()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded" onclick="closeModal('create-deal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–∞–ª–æ–≥–∞ -->
    <div id="catalog" class="fixed inset-0 bg-black bg-opacity-80 hidden flex items-center justify-center z-50">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-purple-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ö–∞—Ç–∞–ª–æ–≥ RF Online</h2>
            <div class="flex gap-2 mb-4">
                <select id="filter-category" class="p-2 bg-gray-800 border border-cyan-500 rounded text-white">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <option value="–ê–∫–∫–∞—É–Ω—Ç—ã">–ê–∫–∫–∞—É–Ω—Ç—ã</option>
                    <option value="–í–∞–ª—é—Ç–∞">–í–∞–ª—é—Ç–∞</option>
                    <option value="–û—Ä—É–∂–∏–µ">–û—Ä—É–∂–∏–µ</option>
                    <option value="–ë—Ä–æ–Ω—è">–ë—Ä–æ–Ω—è</option>
                </select>
                <select id="filter-race" class="p-2 bg-gray-800 border border-cyan-500 rounded text-white">
                    <option value="">–í—Å–µ —Ä–∞—Å—ã</option>
                    <option value="Accretia">Accretia</option>
                    <option value="Bellato">Bellato</option>
                    <option value="Cora">Cora</option>
                </select>
            </div>
            <div id="catalog-items" class="space-y-4"></div>
            <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded mt-4" onclick="closeModal('catalog')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É–∫—Ü–∏–æ–Ω–æ–≤ -->
    <div id="auctions" class="fixed inset-0 bg-black bg-opacity-80 hidden flex items-center justify-center z-50">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-yellow-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ê—É–∫—Ü–∏–æ–Ω—ã RF Online</h2>
            <div id="auction-items" class="space-y-4"></div>
            <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded mt-4" onclick="closeModal('auctions')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profile" class="fixed inset-0 bg-black bg-opacity-80 hidden flex items-center justify-center z-50">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-cyan-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div class="flex items-center mb-4">
                <div id="avatar" class="w-16 h-16 rounded-full border-2 border-pink-500 mr-4"></div>
                <div>
                    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="user-name"></span></p>
                    <p>–†–µ–π—Ç–∏–Ω–≥: <span id="user-rating"></span></p>
                </div>
            </div>
            <canvas id="deal-chart" class="mb-4"></canvas>
            <p>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</p>
            <div id="achievements" class="grid grid-cols-3 gap-2 mb-4"></div>
            <p>–û—Ç–∑—ã–≤—ã:</p>
            <div id="reviews" class="space-y-2 mb-4"></div>
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="closeModal('profile')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
    <div id="support" class="fixed inset-0 bg-black bg-opacity-80 hidden flex items-center justify-center z-50">
        <div class="bg-gray-900 p-6 rounded-lg border-2 border-green-500 w-11/12 max-w-md hologram">
            <h2 class="text-2xl font-bold mb-4">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
            <textarea id="support-message" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..." class="w-full p-2 bg-gray-800 border border-cyan-500 rounded mb-4 text-white"></textarea>
            <div class="flex justify-end gap-2">
                <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded" onclick="sendSupportMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button class="neon-button bg-black border-2 border-pink-500 text-pink-500 p-2 rounded" onclick="closeModal('support')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram
        if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
            document.body.innerHTML = '<h1 class="text-center text-2xl mt-10">–û—à–∏–±–∫–∞: –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram</h1>';
            throw new Error('Telegram authorization failed');
        }

        // WebGL —Ñ–æ–Ω
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('webgl-bg'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        const geometry = new THREE.BufferGeometry();
        const vertices = new Float32Array(2000).map(() => Math.random() * 100 - 50);
        geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
        const material = new THREE.PointsMaterial({ color: 0x00D4FF, size: 0.3 });
        const points = new THREE.Points(geometry, material);
        scene.add(points);
        camera.position.z = 50;
        function animate() {
            requestAnimationFrame(animate);
            points.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
        animate();

        // Haptic Feedback
        function vibrate() {
            if (navigator.vibrate) navigator.vibrate(50);
        }
        document.querySelectorAll('.neon-button').forEach(btn => btn.addEventListener('click', vibrate));

        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.display = 'flex';
                gsap.from(`#${id} .hologram`, { opacity: 0, y: 20, stagger: 0.1 });
                if (id === 'catalog') loadCatalog();
                if (id === 'auctions') loadAuctions();
                if (id === 'profile') loadProfile();
            }
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                gsap.to(`#${id} .hologram`, {
                    opacity: 0,
                    y: 20,
                    stagger: 0.1,
                    onComplete: () => modal.style.display = 'none'
                });
            }
        }

        async function createDeal() {
            const item = document.getElementById('deal-item').value;
            const price = document.getElementById('deal-price').value;
            const currency = document.getElementById('deal-currency').value;
            const partner = document.getElementById('deal-partner').value;
            const time = document.getElementById('deal-time').value;
            if (!item || !price || !partner || !time || !currency) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            if (!partner.startsWith('@')) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Telegram ID (–Ω–∞–ø—Ä., @username)');
                return;
            }
            try {
                const res = await fetch('/api/deal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ item, price, currency, partner, time, user: tg.initDataUnsafe.user.id })
                });
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                const data = await res.json();
                tg.showAlert(`–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! ID: ${data.dealId}`);
                closeModal('create-deal');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–¥–µ–ª–∫–∏: ' + error.message);
            }
        }

        async function loadCatalog() {
            const category = document.getElementById('filter-category').value;
            const race = document.getElementById('filter-race').value;
            try {
                const res = await fetch(`/api/catalog?category=${category}&race=${race}`);
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞');
                const items = await res.json();
                const catalog = document.getElementById('catalog-items');
                catalog.innerHTML = items.map(item => `
                    <div class="bg-gray-800 p-4 rounded-lg transform transition-transform hover:rotate-3 hologram">
                        <h3 class="text-lg font-semibold">${item.name}</h3>
                        <p>–¶–µ–Ω–∞: ${item.price} ${item.currency}</p>
                        <p>–†–µ–π—Ç–∏–Ω–≥: ${'‚òÖ'.repeat(item.rating)}</p>
                        ${item.race ? `<p>–†–∞—Å–∞: ${item.race}</p>` : ''}
                        <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded mt-2" onclick="createDealFromCatalog('${item.name}', ${item.price}, '${item.currency}')">–ö—É–ø–∏—Ç—å</button>
                    </div>
                `).join('');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞: ' + error.message);
            }
        }

        async function loadAuctions() {
            try {
                const res = await fetch('/api/auctions');
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–∫—Ü–∏–æ–Ω–æ–≤');
                const items = await res.json();
                const auctions = document.getElementById('auction-items');
                auctions.innerHTML = items.map(item => `
                    <div class="bg-gray-800 p-4 rounded-lg transform transition-transform hover:rotate-3 hologram">
                        <h3 class="text-lg font-semibold">${item.name}</h3>
                        <p>–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞: ${item.currentBid} ${item.currency}</p>
                        <p>–û—Å—Ç–∞–ª–æ—Å—å: ${item.timeLeft}</p>
                        ${item.race ? `<p>–†–∞—Å–∞: ${item.race}</p>` : ''}
                        <button class="neon-button bg-black border-2 border-yellow-500 text-yellow-500 p-2 rounded mt-2" onclick="placeBid('${item._id}', ${item.currentBid + 100}, '${item.currency}')">–°—Ç–∞–≤–∫–∞</button>
                    </div>
                `).join('');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–∫—Ü–∏–æ–Ω–æ–≤: ' + error.message);
            }
        }

        function createDealFromCatalog(item, price, currency) {
            document.getElementById('deal-item').value = item;
            document.getElementById('deal-price').value = price;
            document.getElementById('deal-currency').value = currency;
            closeModal('catalog');
            showModal('create-deal');
        }

        async function placeBid(auctionId, bid, currency) {
            try {
                const res = await fetch('/api/auction/bid', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ auctionId, bid, currency, user: tg.initDataUnsafe.user.id })
                });
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ —Å—Ç–∞–≤–∫–∏');
                const data = await res.json();
                tg.showAlert(`–°—Ç–∞–≤–∫–∞ ${bid} ${currency} –ø—Ä–∏–Ω—è—Ç–∞!`);
                loadAuctions();
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏: ' + error.message);
            }
        }

        async function loadTopItems() {
            try {
                const res = await fetch('/api/catalog?top=5');
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ø-—Ç–æ–≤–∞—Ä–æ–≤');
                const items = await res.json();
                const topItems = document.getElementById('top-items');
                topItems.innerHTML = items.map(item => `
                    <div class="bg-gray-800 p-4 rounded-lg transform transition-transform hover:rotate-3 hologram">
                        <h3 class="text-lg font-semibold">${item.name}</h3>
                        <p>–¶–µ–Ω–∞: ${item.price} ${item.currency}</p>
                        <button class="neon-button bg-black border-2 border-cyan-500 text-cyan-500 p-2 rounded mt-2" onclick="createDealFromCatalog('${item.name}', ${item.price}, '${item.currency}')">–ö—É–ø–∏—Ç—å</button>
                    </div>
                `).join('');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ø-—Ç–æ–≤–∞—Ä–æ–≤: ' + error.message);
            }
        }
        loadTopItems();

        async function loadNews() {
            try {
                const res = await fetch('/api/news');
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π');
                const news = await res.json();
                document.getElementById('news').innerHTML = news.map(n => `<p class="hologram">${n.text}</p>`).join('');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π: ' + error.message);
            }
        }
        loadNews();

        async function loadProfile() {
            try {
                document.getElementById('user-name').innerText = tg.initDataUnsafe.user.username || '–ê–Ω–æ–Ω–∏–º';
                document.getElementById('user-rating').innerText = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
                document.getElementById('avatar').style.backgroundImage = `url(${tg.initDataUnsafe.user.photo_url || 'https://via.placeholder.com/64'})`;
                const res = await fetch(`/api/user/${tg.initDataUnsafe.user.id}`);
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                const user = await res.json();
                document.getElementById('achievements').innerHTML = user.achievements.map(a => `
                    <div class="bg-gray-800 p-2 rounded hologram">${a}</div>
                `).join('');
                document.getElementById('reviews').innerHTML = user.reviews.map(r => `
                    <div class="bg-gray-800 p-2 rounded hologram">
                        <p>${'‚òÖ'.repeat(r.rating)} ${r.text}</p>
                        <p class="text-sm text-gray-400">–û—Ç–≤–µ—Ç: ${r.reply}</p>
                    </div>
                `).join('');
                new Chart(document.getElementById('deal-chart'), {
                    type: 'line',
                    data: {
                        labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä'],
                        datasets: [{ label: '–°–¥–µ–ª–∫–∏', data: [10, 20, 15, 25], borderColor: '#00D4FF' }]
                    },
                    options: { plugins: { legend: { labels: { color: '#fff' } } }, scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } } }
                });
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è: ' + error.message);
            }
        }

        async function sendSupportMessage() {
            const message = document.getElementById('support-message').value;
            if (!message) {
                tg.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!');
                return;
            }
            try {
                const res = await fetch('/api/support', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, user: tg.initDataUnsafe.user.id })
                });
                if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
                tg.showAlert('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                closeModal('support');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + error.message);
            }
        }
    </script>
</body>
</html>
